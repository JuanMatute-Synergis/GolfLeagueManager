<!-- Scorecard Viewer Modal -->
<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 scorecard-viewer" 
     *ngIf="isOpen"
     (click)="onBackdropClick($event)">
  <div class="bg-card border border-border rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden flex flex-col"
       (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="bg-primary text-primary-foreground p-4 flex justify-between items-center flex-shrink-0">
      <div>
        <h2 class="text-xl font-bold">Scorecard</h2>
        <p class="text-sm opacity-90">{{ flightName }} - {{ course.name }}</p>
      </div>
      <button 
        (click)="onClose()"
        class="text-primary-foreground hover:bg-primary/80 rounded-full p-2 transition-colors"
        aria-label="Close scorecard">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <!-- Loading State -->
    <div class="flex items-center justify-center p-8 flex-1" *ngIf="isLoading">
      <div class="text-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
        <p class="text-muted-foreground">Loading scorecard...</p>
      </div>
    </div>

    <!-- Error State -->
    <div class="flex items-center justify-center p-8 flex-1" *ngIf="error && !isLoading">
      <div class="text-center">
        <div class="bg-destructive/10 border border-destructive/20 text-destructive p-4 rounded-lg">
          <p class="font-medium">{{ error }}</p>
        </div>
      </div>
    </div>

    <!-- Scorecard Content -->
    <div *ngIf="!isLoading && !error && scorecardData" class="flex-1 overflow-hidden flex flex-col">
      
      <!-- Players Header -->
      <div class="bg-muted/20 border-b border-border p-4 flex-shrink-0">
        <div class="grid grid-cols-2 gap-4">
          <!-- Player A Section -->
          <div class="text-center">
            <h3 class="font-bold text-lg text-foreground">{{ playerAName }}</h3>
            <div class="text-sm text-muted-foreground mb-2">Player A</div>
            
            <!-- Absence Status -->
            <div *ngIf="scorecardData.playerAAbsent" class="text-sm">
              <span class="inline-block bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded-full">
                Absent {{ scorecardData.playerAAbsentWithNotice ? '(With Notice)' : '(No Notice)' }}
              </span>
            </div>
          </div>
          
          <!-- Player B Section -->
          <div class="text-center">
            <h3 class="font-bold text-lg text-foreground">{{ playerBName }}</h3>
            <div class="text-sm text-muted-foreground mb-2">Player B</div>
            
            <!-- Absence Status -->
            <div *ngIf="scorecardData.playerBAbsent" class="text-sm">
              <span class="inline-block bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 px-2 py-1 rounded-full">
                Absent {{ scorecardData.playerBAbsentWithNotice ? '(With Notice)' : '(No Notice)' }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <!-- Scorecard Table -->
      <div class="flex-1 overflow-auto bg-background">
        <table class="w-full text-sm border-collapse">
          <!-- Front 9 Header -->
          <thead class="sticky top-0 z-10 bg-background">
            <tr>
              <th class="border border-border p-2 text-left font-semibold text-foreground bg-muted/20">Hole</th>
              <th class="border border-border p-2 text-center font-semibold text-foreground bg-muted/20" 
                  *ngFor="let hole of getFrontNine()">
                {{ hole.number }}
              </th>
              <th class="border border-border p-2 text-center font-semibold text-foreground bg-muted/20">OUT</th>
            </tr>
            <tr>
              <th class="border border-border p-2 text-left font-semibold text-foreground bg-muted/20">Par</th>
              <th class="border border-border p-2 text-center text-foreground font-semibold bg-muted/20" 
                  *ngFor="let hole of getFrontNine()">
                {{ hole.par }}
              </th>
              <th class="border border-border p-2 text-center font-medium text-foreground bg-muted/20">{{ getFrontNinePar() }}</th>
            </tr>
          </thead>
          
          <!-- Player A Front 9 -->
          <tbody>
            <tr class="hover:bg-muted/10">
              <td class="border border-border p-2 font-medium text-foreground bg-muted/30">{{ playerAName }}</td>
              <td class="border border-border p-2 text-center" *ngFor="let hole of getFrontNine(); let i = index">
                <span class="inline-flex w-8 h-8 bg-muted text-foreground rounded-full items-center justify-center font-semibold text-center leading-none text-sm">
                  {{ getScoreDisplay(scorecardData.holes[i].playerAScore) }}
                </span>
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-muted/30">
                {{ getPlayerFrontNineTotal('A') || '-' }}
              </td>
            </tr>
            
            <!-- Player B Front 9 -->
            <tr class="hover:bg-muted/10">
              <td class="border border-border p-2 font-medium text-foreground bg-muted/30">{{ playerBName }}</td>
              <td class="border border-border p-2 text-center" *ngFor="let hole of getFrontNine(); let i = index">
                <span class="inline-flex w-8 h-8 bg-muted text-foreground rounded-full items-center justify-center font-semibold text-center leading-none text-sm">
                  {{ getScoreDisplay(scorecardData.holes[i].playerBScore) }}
                </span>
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-muted/30">
                {{ getPlayerFrontNineTotal('B') || '-' }}
              </td>
            </tr>
          </tbody>

          <!-- Back 9 Header -->
          <thead class="sticky top-0 z-10 bg-background">
            <tr>
              <th class="border border-border p-2 text-left font-semibold text-foreground bg-muted/20">Hole</th>
              <th class="border border-border p-2 text-center font-semibold text-foreground bg-muted/20" 
                  *ngFor="let hole of getBackNine()">
                {{ hole.number }}
              </th>
              <th class="border border-border p-2 text-center font-semibold text-foreground bg-muted/20">IN</th>
              <th class="border border-border p-2 text-center font-semibold text-foreground bg-muted/20">TOTAL</th>
            </tr>
            <tr>
              <th class="border border-border p-2 text-left font-semibold text-foreground bg-muted/20">Par</th>
              <th class="border border-border p-2 text-center text-foreground font-semibold bg-muted/20" 
                  *ngFor="let hole of getBackNine()">
                {{ hole.par }}
              </th>
              <th class="border border-border p-2 text-center font-medium text-foreground bg-muted/20">{{ getBackNinePar() }}</th>
              <th class="border border-border p-2 text-center font-bold text-foreground bg-muted/20">{{ getTotalPar() }}</th>
            </tr>
          </thead>
          
          <!-- Player A Back 9 -->
          <tbody>
            <tr class="hover:bg-muted/10">
              <td class="border border-border p-2 font-medium text-foreground bg-muted/30">{{ playerAName }}</td>
              <td class="border border-border p-2 text-center" *ngFor="let hole of getBackNine(); let i = index">
                <span class="inline-flex w-8 h-8 bg-muted text-foreground rounded-full items-center justify-center font-semibold text-center leading-none text-sm">
                  {{ getScoreDisplay(scorecardData.holes[i + 9].playerAScore) }}
                </span>
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-muted/30">
                {{ getPlayerBackNineTotal('A') || '-' }}
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-primary/10">
                {{ scorecardData.playerATotalScore || '-' }}
              </td>
            </tr>
            
            <!-- Player B Back 9 -->
            <tr class="hover:bg-muted/10">
              <td class="border border-border p-2 font-medium text-foreground bg-muted/30">{{ playerBName }}</td>
              <td class="border border-border p-2 text-center" *ngFor="let hole of getBackNine(); let i = index">
                <span class="inline-flex w-8 h-8 bg-muted text-foreground rounded-full items-center justify-center font-semibold text-center leading-none text-sm">
                  {{ getScoreDisplay(scorecardData.holes[i + 9].playerBScore) }}
                </span>
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-muted/30">
                {{ getPlayerBackNineTotal('B') || '-' }}
              </td>
              <td class="border border-border p-2 text-center font-bold text-foreground bg-primary/10">
                {{ scorecardData.playerBTotalScore || '-' }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Match Summary -->
      <div class="border-t border-border p-4 bg-muted/10 flex-shrink-0" *ngIf="scorecardData.holes.length > 0">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
          <!-- Total Scores -->
          <div>
            <h4 class="font-semibold text-foreground mb-2">Final Scores</h4>
            <div class="space-y-1">
              <div class="text-sm">{{ playerAName }}: <span class="font-bold">{{ scorecardData.playerATotalScore || '-' }}</span></div>
              <div class="text-sm">{{ playerBName }}: <span class="font-bold">{{ scorecardData.playerBTotalScore || '-' }}</span></div>
            </div>
          </div>

          <!-- Holes Won -->
          <div>
            <h4 class="font-semibold text-foreground mb-2">Holes Won</h4>
            <div class="space-y-1">
              <div class="text-sm">{{ playerAName }}: <span class="font-bold">{{ scorecardData.playerAHolesWon }}</span></div>
              <div class="text-sm">{{ playerBName }}: <span class="font-bold">{{ scorecardData.playerBHolesWon }}</span></div>
              <div class="text-sm">Halved: <span class="font-bold">{{ scorecardData.holesHalved }}</span></div>
            </div>
          </div>

          <!-- Match Points -->
          <div *ngIf="scorecardData.playerAMatchPoints !== undefined || scorecardData.playerBMatchPoints !== undefined">
            <h4 class="font-semibold text-foreground mb-2">Match Points</h4>
            <div class="space-y-1">
              <div class="text-sm">{{ playerAName }}: <span class="font-bold">{{ scorecardData.playerAMatchPoints || 0 }}</span></div>
              <div class="text-sm">{{ playerBName }}: <span class="font-bold">{{ scorecardData.playerBMatchPoints || 0 }}</span></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
